# CVE Request Form - Bastillion Path Traversal Vulnerability

## Vulnerability Type Info
```
Path Traversal / Directory Traversal (CWE-22)
```

## Vendor of the Product(s) Info
```
Vendor: bastillion-io
Vendor Website: https://www.bastillion.io/
GitHub: https://github.com/bastillion-io
```

## Affected Product(s)/Code Base Info

### Product and Version Information

| Product | Affected Versions | Fixed Version |
|---------|------------------|---------------|
| Bastillion | 4.00.00-SNAPSHOT and all prior versions | Not yet fixed |

**Product Description**: Bastillion is a web-based SSH console that centrally manages administrative access to systems. It provides SSH key management and remote command execution capabilities.

**Software Links**:
- GitHub Repository: https://github.com/bastillion-io/Bastillion
- Official Website: https://www.bastillion.io/

## Has Vendor Confirmed or Acknowledged the Vulnerability?
```
No - Vulnerability has not yet been reported to the vendor
```

## Attack Type Info
```
Remote - Network-based attack requiring authentication
```

## Impact Info
```
☑ Code Execution
☑ Information Disclosure
☐ Denial of Service
☑ Escalation of Privileges
☐ Other
```

**Impact Details**:
- **Code Execution**: Attackers can upload malicious files to directories like `/etc/cron.d/` to achieve remote code execution with elevated privileges
- **Information Disclosure**: Access to sensitive files and directories on managed remote systems
- **Escalation of Privileges**: Files can be executed with the privileges of the SSH connection user (often root or privileged accounts)

## Affected Component(s)
```
src/main/java/io/bastillion/manage/util/SSHUtil.java (pushUpload method, line 230-248)
src/main/java/io/bastillion/manage/control/UploadAndPushKtrl.java (uploadSubmit method, line 76-129; push method, line 132-201)
```

## Attack Vector(s)

**Exploitation Method**:

To exploit this vulnerability, an attacker must:

1. **Authentication Required**: Obtain valid credentials for a Bastillion user account with file upload permissions (typically administrator or manager role)

2. **Access Upload Interface**: Navigate to the file upload functionality via `/admin/setUpload?idList=[target_systems]`

3. **Upload Malicious File**: Submit a file through the upload form with a manipulated `pushDir` parameter containing path traversal sequences

4. **Trigger Distribution**: Initiate the file push operation to distribute the file to managed remote systems

**Example Attack Flow**:
```
1. Authenticate to Bastillion application
2. Access upload interface: GET /admin/setUpload?idList=1,2,3
3. Upload file with modified pushDir parameter:
   - Normal value: "uploads"
   - Malicious value: "../../etc/cron.d"
4. Execute push operation: POST /admin/push
5. File is uploaded to /etc/cron.d/ on all selected remote systems
```

**Technical Details**:
The `pushDir` form parameter is extracted from the multipart upload request without proper validation. Only tilde (`~`) characters are filtered out, but path traversal sequences like `../` are not sanitized. This allows an attacker to break out of the intended upload directory and write files to arbitrary locations on remote SSH servers.

## Suggested Description of the Vulnerability for Use in the CVE

```
A path traversal vulnerability exists in Bastillion version 4.00.00-SNAPSHOT and earlier in the file upload functionality (SSHUtil.pushUpload method). The vulnerability allows authenticated users with file upload permissions to upload files to arbitrary directories on managed remote SSH servers by manipulating the pushDir parameter with path traversal sequences (e.g., ../../etc/). The application only filters tilde characters but does not validate or sanitize path traversal sequences, enabling attackers to write files outside the intended upload directory. Successful exploitation can lead to remote code execution by uploading malicious files to sensitive locations such as /etc/cron.d/, privilege escalation, and unauthorized access to managed systems. The vulnerability affects all remote systems managed through the Bastillion instance.
```

## Discoverer(s)/Credits Info
```
Discovered by: s1ain
Date of Discovery: November 2, 2025
```

## Reference(s) Info
```
https://github.com/bastillion-io/Bastillion
https://www.bastillion.io/
https://cwe.mitre.org/data/definitions/22.html
https://owasp.org/www-community/attacks/Path_Traversal
```

## Additional Information

### CVSS v3.1 Score Estimation
```
CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H

Base Score: 7.2 (High)

Vector Breakdown:
- Attack Vector (AV): Network (N)
- Attack Complexity (AC): Low (L)
- Privileges Required (PR): High (H) - Requires authenticated access with upload permissions
- User Interaction (UI): None (N)
- Scope (S): Unchanged (U)
- Confidentiality (C): High (H)
- Integrity (I): High (H)
- Availability (A): High (H)
```

### Affected Code Analysis

**Vulnerable Function 1** (`SSHUtil.java:230-248`):
```java
public static HostSystem pushUpload(HostSystem hostSystem, Session session, String source, String destination) {
    // ...
    destination = destination.replaceAll("~\\/|~", "");  // Insufficient filtering
    c.put(file, destination);  // SFTP upload with unsanitized path
    // ...
}
```

**Vulnerable Function 2** (`UploadAndPushKtrl.java`):
```java
} else {
    pushDir = item.getString();  // User-controlled input without validation
}
// ...
SSHUtil.pushUpload(pendingSystemStatus, session.getSession(),
    UPLOAD_PATH + "/" + uploadFileName,
    pushDir + "/" + uploadFileName);  // Vulnerable call
```

### Exploitation Scenarios

**Scenario 1 - Cron Job Upload for RCE**:
- Upload: Malicious cron job file
- Path: `../../etc/cron.d`
- Result: Scheduled task executes with root privileges

**Scenario 2 - SSH Key Injection**:
- Upload: Attacker's public SSH key
- Path: `../../.ssh/authorized_keys`
- Result: Persistent backdoor access

**Scenario 3 - Web Shell Upload**:
- Upload: PHP/JSP web shell
- Path: `../../../../var/www/html`
- Result: Web-based remote code execution

**Scenario 4 - Binary Replacement**:
- Upload: Malicious executable
- Path: `../../usr/local/bin`
- Result: Trojanized system utilities

### Security Impact Assessment

**Multi-System Amplification**:
Since Bastillion manages multiple SSH servers simultaneously, a single exploit attempt can compromise all managed systems in one operation, significantly amplifying the attack impact.

**Privilege Context**:
Files are uploaded with the permissions of the SSH connection user configured in Bastillion, which is often root or a highly privileged service account, making this vulnerability particularly severe.

**Detection Difficulty**:
The vulnerability may evade detection in environments with limited file integrity monitoring, as legitimate file upload operations and malicious path traversal attacks appear similar in standard logs.

### Recommended Vendor Actions

1. **Immediate**: Implement comprehensive path validation and sanitization
2. **Short-term**: Add whitelist-based directory restrictions
3. **Long-term**: Implement per-system upload path configurations with database-backed restrictions
4. **Security**: Add detailed audit logging for all file upload operations

### Disclosure Timeline

- **November 2, 2025**: Vulnerability discovered during security audit
- **[Pending]**: Coordinated disclosure to bastillion-io maintainers
- **[Pending]**: CVE ID assignment
- **[Pending]**: Public disclosure after vendor patch availability

### Additional Notes

This vulnerability requires authentication and specific permissions, which reduces the attack surface but does not eliminate the severity. In managed service provider (MSP) environments or multi-tenant deployments, a compromised low-privilege Bastillion account could be leveraged to compromise all managed infrastructure.

The vulnerability is particularly concerning in cloud and enterprise environments where Bastillion is deployed to manage hundreds or thousands of SSH endpoints, as a single exploit can cascade across the entire managed infrastructure.
