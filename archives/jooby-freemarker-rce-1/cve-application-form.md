# CVE Application Form - Jooby FreeMarker RCE

## Vulnerability Type Info
**Code Execution**

## Vendor of the Product(s) Info
**Vendor Name**: Jooby Project
**Vendor Website**: https://jooby.io
**Vendor Contact**: https://github.com/jooby-project/jooby

## Affected Product(s)/Code Base Info

| Product | Version |
|---------|---------|
| Jooby FreeMarker Module (io.jooby:jooby-freemarker) | All versions from 1.0.0 to 4.0.11-SNAPSHOT (inclusive) |

**Version Details**:
- **Affected**: All versions (1.x, 2.x, 3.x, 4.x)
- **Fixed**: None (vulnerability not yet patched)
- **Confirmed Vulnerable**: 4.0.11-SNAPSHOT (latest development version)

## Has Vendor Confirmed or Acknowledged the Vulnerability?
**No** (vendor not yet notified at time of CVE submission)

## Attack Type Info
**Remote Code Execution (RCE)**

## Impact Info
- [x] Code Execution
- [x] Information Disclosure
- [x] Denial of Service
- [ ] Escalation of Privileges
- [x] Other: Full Server Compromise

**Primary Impact**: Remote Code Execution
**Secondary Impacts**:
- Arbitrary file read/write
- Network access from compromised server
- Complete confidentiality, integrity, and availability breach

## Affected Component(s)
```
modules/jooby-freemarker/src/main/java/io/jooby/freemarker/FreemarkerModule.java (line 127),
io.jooby.freemarker.FreemarkerModule class constructor,
FreeMarker template rendering engine configuration
```

## Attack Vector(s)

**Method of Exploitation**:

1. **Attack Vector 1 - User-Controlled Template Content**:
   - Attacker provides malicious FreeMarker template code through application input (e.g., query parameters, POST body, file upload)
   - Application renders the user-provided template using Jooby's FreemarkerModule
   - Malicious template uses FreeMarker's `?new` built-in to instantiate dangerous Java classes
   - Example payload: `<#assign ex="freemarker.template.utility.Execute"?new()>${ex("whoami")}`

2. **Attack Vector 2 - User-Controlled Template Model Data**:
   - Attacker controls data passed to template rendering (e.g., JSON input mapped to template model)
   - Template accesses attacker-controlled properties that return malicious template expressions
   - FreeMarker evaluates the malicious expressions with unrestricted class access

3. **Attack Vector 3 - Template Injection via Application Features**:
   - Application allows template customization (e.g., email templates, report templates, notification templates)
   - Attacker injects malicious template code through the customization interface
   - Template is rendered with UNRESTRICTED_RESOLVER configuration

**Prerequisites for Successful Exploitation**:
- Application uses Jooby FreeMarker module (jooby-freemarker dependency)
- One of the following conditions exists:
  - Attacker can control template content (directly or indirectly)
  - Attacker can control data passed to template model
  - Application allows template customization/upload features

**No Special Tools Required**: Standard HTTP client (curl, browser) is sufficient

## Suggested Description of the Vulnerability for Use in the CVE

The Jooby FreeMarker module (io.jooby:jooby-freemarker) in all versions through 4.0.11-SNAPSHOT configures Apache FreeMarker with TemplateClassResolver.UNRESTRICTED_RESOLVER, which allows FreeMarker templates to instantiate arbitrary Java classes via the ?new built-in function. This misconfiguration enables remote attackers to execute arbitrary code on the server when they can control template content or template model data. Attackers can exploit this by injecting malicious FreeMarker expressions that instantiate dangerous classes such as freemarker.template.utility.Execute to execute system commands, or java.io.FileReader to read sensitive files. The vulnerability affects all applications using the jooby-freemarker module and can lead to complete server compromise. This issue exists because FreemarkerModule.java (line 127) sets configuration.setNewBuiltinClassResolver(TemplateClassResolver.UNRESTRICTED_RESOLVER) instead of the recommended SAFER_RESOLVER.

## Discoverer(s)/Credits Info

**Discoverer**: s1ain
**Affiliation**: Independent Security Researcher
**Discovery Date**: November 2025
**Discovery Method**: Security code audit of Jooby Framework

## Reference(s) Info

https://github.com/jooby-project/jooby
https://github.com/jooby-project/jooby/blob/main/modules/jooby-freemarker/src/main/java/io/jooby/freemarker/FreemarkerModule.java
https://freemarker.apache.org/docs/api/freemarker/core/TemplateClassResolver.html
https://freemarker.apache.org/docs/app_faq.html#faq_template_uploading_security
https://cwe.mitre.org/data/definitions/94.html
https://cwe.mitre.org/data/definitions/95.html

## Additional Information

**CVSS:3.1 Metrics**:
- **Vector String**: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
- **Base Score**: 8.8 (High) - for authenticated endpoints
- **Base Score**: 9.8 (Critical) - if vulnerable endpoints are unauthenticated

**CWE Classifications**:
- CWE-94: Improper Control of Generation of Code ('Code Injection')
- CWE-95: Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection')

**Vulnerability Characteristics**:
- **Type**: Configuration vulnerability leading to RCE
- **Root Cause**: Use of UNRESTRICTED_RESOLVER instead of SAFER_RESOLVER
- **Exploitation Complexity**: Low (simple template injection payload)
- **Attack Requirements**: Network access + ability to influence template content or model data
- **Detection**: Easy (static code analysis can identify the insecure configuration)
- **Fix Complexity**: Low (one-line configuration change)

**Recommended Fix**:
Change line 127 in FreemarkerModule.java from:
```java
configuration.setNewBuiltinClassResolver(TemplateClassResolver.UNRESTRICTED_RESOLVER);
```
to:
```java
configuration.setNewBuiltinClassResolver(TemplateClassResolver.SAFER_RESOLVER);
```

**Proof of Concept Summary**:
A complete proof of concept demonstrating command execution is available. The PoC shows how an attacker can execute the `whoami` command by injecting the payload: `<#assign ex="freemarker.template.utility.Execute"?new()>${ex("whoami")}` through vulnerable template rendering endpoints.

**Impact Scenarios**:
1. **Multi-tenant SaaS applications**: If tenants can customize templates, one tenant could compromise the entire server
2. **Email template systems**: Custom email templates could be used to execute code
3. **Reporting systems**: Custom report templates could lead to data exfiltration
4. **CMS platforms**: Template customization features become RCE vectors
5. **API gateways**: Dynamic template rendering for responses could be exploited

**Affected Ecosystem**:
- Maven Central package: io.jooby:jooby-freemarker
- Estimated downloads: Thousands of applications potentially affected
- Framework popularity: Jooby is a widely-used modern Java web framework

**Vendor Notification Status**:
- Vulnerability discovered: 2025-11-02
- Vendor notification: Pending (to be sent after CVE assignment)
- Expected patch timeline: TBD

**Public Disclosure Plan**:
- Responsible disclosure will be followed
- 90-day disclosure timeline after vendor notification
- Coordination with Jooby maintainers for patch development
- Public advisory to be released with CVE details

**Similar Vulnerabilities**:
- CVE-2020-25631: Similar FreeMarker SSTI in other Java frameworks
- Multiple SSTI vulnerabilities in template engines with insufficient sandboxing

**Testing Notes**:
- Vulnerability confirmed in version 4.0.11-SNAPSHOT
- Issue present in source code since initial release of FreeMarker module
- All branches (2.x, 3.x, 4.x) contain the vulnerable configuration
- No variation in vulnerability across different deployment environments

**Submitter Contact Information**:
- Name: s1ain
- Role: Independent Security Researcher
- Availability: Available for clarifications and coordination
